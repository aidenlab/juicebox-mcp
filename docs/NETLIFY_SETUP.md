# Netlify Deployment Guide for Juicebox MCP Frontend

This guide covers the configuration for hosting the Juicebox MCP frontend on Netlify.

## Overview

The Juicebox MCP project has two build configurations:
- **Library build** (`npm run build`): Builds the library for npm package distribution
- **Netlify build** (`npm run build:netlify`): Builds a standard web app for Netlify hosting

## Quick Setup Checklist

- [ ] MCP server running locally
- [ ] MCP HTTP tunnel active (port 3000)
- [ ] WebSocket tunnel active (port 3001)
- [ ] `VITE_WS_URL` set in Netlify environment variables
- [ ] Netlify deployment completed

## Build Configuration

### For Netlify Deployment

Use the Netlify-specific build command:

```bash
npm run build:netlify
```

This uses `vite.config.netlify.js` which:
- Builds as a standard web app (not a library)
- Outputs to `dist/` directory
- Includes `index.html` as the entry point
- Uses `src/main.js` as the application entry point

### For Library Distribution

Use the standard build command:

```bash
npm run build
```

This uses `vite.config.js` which builds the library for npm package distribution.

## Netlify Configuration

The project includes a `netlify.toml` file that configures:
- Build command: `npm run build:netlify`
- Publish directory: `dist`
- SPA routing: All routes redirect to `index.html`

## Setup Steps

### Step 1: Start Your MCP Server

**Important:** When hosting the frontend on Netlify, you must start the MCP server with the `-u` (or `--browser-url`) command line parameter specifying your Netlify URL. This ensures that connection links generated by the MCP server point to your Netlify deployment.

```bash
cd /path/to/juicebox-mcp
node server.js --browser-url https://your-app.netlify.app/
```

Replace `https://your-app.netlify.app` with your actual Netlify URL.

**Alternative syntax:**
```bash
node server.js -u https://your-app.netlify.app
```

The server will start on:
- MCP endpoint: `http://localhost:3000/mcp`
- WebSocket: `ws://localhost:3001`

### Step 2: Create Tunnels

You need **two tunnels** - one for MCP HTTP and one for WebSocket.

#### Using ngrok:

**Terminal 1 - MCP HTTP tunnel (for ChatGPT/Cursor):**
```bash
ngrok http 3000
```
Creates URL (e.g., `https://sagittal-christiana-glareless.ngrok-free.dev`)

**Terminal 2 - WebSocket tunnel (for Netlify hosted app):**
```bash
npm install -g localtunnel
lt --port 3001 --subdomain your-app-websocket
```
Creates URL: (e.g., `https://your-app-websocket.loca.lt`)

**Benefits of localtunnel:**
- ✅ Custom subdomains that remain consistent (as long as the subdomain is available)
- ✅ No account required for basic usage
- ✅ Simple command-line interface

### Step 3: Configure Netlify

1. Go to your Netlify site dashboard
2. Navigate to **Site settings** → **Environment variables**
3. Add a new variable:
   - **Key**: `VITE_WS_URL`
   - **Value**: 
     - If using ngrok: `wss://your-websocket-ngrok-url.ngrok-free.app`
     - If using localtunnel: `wss://your-app-websocket.loca.lt`
   - ⚠️ **Important**: Use `wss://` (not `ws://`) for secure WebSocket
4. **Redeploy** your site (or trigger a new deployment)

### Step 4: Configure MCP Client (Cursor/ChatGPT)

Configure your MCP client with the tunneled MCP HTTP URL.

**For Cursor:**
Add to Cursor Settings → Features → Model Context Protocol:
```json
{
  "mcpServers": {
    "juicebox-server": {
      "url": "https://your-mcp-tunnel-url.ngrok-free.app/mcp"
    }
  }
}
```

**For ChatGPT:**
1. Open ChatGPT → Settings → Personalization → Model Context Protocol
2. Add server:
   - **Name**: `juicebox-server`
   - **URL**: `https://your-mcp-tunnel-url.ngrok-free.app/mcp` (include `/mcp`!)
   - **Transport**: HTTP or Streamable HTTP

## Testing the Connection

1. **Open your Netlify site** in a browser
2. **Open browser console** (F12)
3. **Check for WebSocket connection logs**:
   - Should see: `WebSocket connected`
   - Status indicator should show "connected"

4. **Test MCP connection**:
   - In Cursor/ChatGPT, try: "Load a Hi-C map"
   - The map should load in your Netlify app

## Important Notes

- **Keep tunnels active**: Both tunnels must remain running. If either tunnel stops, the corresponding connection will fail.
- **Redeploy Netlify after URL changes**: When your tunnel WebSocket URL changes, you must update `VITE_WS_URL` in Netlify and trigger a new deployment for the change to take effect.
- **Build command**: Make sure Netlify is configured to use `npm run build:netlify` (this is set in `netlify.toml`)

## Troubleshooting

### WebSocket Not Connecting

- ✅ Verify `VITE_WS_URL` is set in Netlify environment variables
- ✅ Check that you've redeployed after setting the variable
- ✅ Ensure WebSocket URL uses `wss://` (not `ws://`) for HTTPS sites
- ✅ Check browser console for connection errors
- ✅ Verify your WebSocket tunnel is still active

### MCP Client Can't Connect

- ✅ Verify MCP endpoint URL includes `/mcp` at the end
- ✅ Check that MCP server is running locally
- ✅ Ensure MCP tunnel is still active
- ✅ Check server logs for connection errors

### Build Fails on Netlify

- ✅ Verify `netlify.toml` is in the repository root
- ✅ Check that `vite.config.netlify.js` exists
- ✅ Ensure all dependencies are listed in `package.json`
- ✅ Check Netlify build logs for specific errors

### Changes Not Appearing in Browser

- ✅ Verify WebSocket connection is established (check browser console)
- ✅ Ensure MCP server is broadcasting commands
- ✅ Check that both tunnels are still active
- ✅ Verify you're using the correct build command (`build:netlify`)

## Local Development

For local development, you can use:

```bash
npm run dev
```

This uses the standard Vite dev server. For testing the Netlify build locally:

```bash
npm run build:netlify
npm run preview:netlify
```

## Next Steps

Once connected:
- Try loading Hi-C maps: "Load a Hi-C map from [URL]"
- Try zooming: "Zoom in at coordinates X, Y"
- Try changing colors: "Set foreground color to red"
- Try loading sessions: "Load session from [URL]"
